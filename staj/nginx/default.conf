server {
    listen 80;
    server_name localhost;

    # Kök dizininizin doğru olduğundan emin olun.
    # Symfony projenizin "public" klasörüne işaret etmeli.
    # Örnek: root /home/harunkaraca/PhpstormProjects/staj/staj/symfony-app/public;
    root /var/www/html/public; # <-- BURAYI KENDİ PROJE DİZİNİNİZİN "public" KLASÖRÜYLE GÜNCELLEYİN

    index index.php index.html;

    charset utf-8;

    # Tüm istekler için ana kural.
    # Eğer dosya veya dizin yoksa, isteği /index.php'ye yönlendirir.
    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }

    # index.php'ye yapılan istekleri PHP-FPM'ye yönlendiren blok.
    # Bu blok, Symfony'nin ana giriş noktası olan index.php'yi işler.
    location ~ ^/index\.php(/|$) {
        # php:9000 eğer PHP-FPM'niz bir Docker konteynerinde veya ağda 'php' adıyla çalışıyorsa doğrudur.
        # Yerel bir Linux/macOS sisteminde genellikle unix:/var/run/php/phpX.Y-fpm.sock şeklindedir.
        fastcgi_pass php:9000;

        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        include fastcgi_params;

        # Bu iki parametre genellikle önemlidir ve Symfony için doğru dosya yolunu sağlar.
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        fastcgi_param DOCUMENT_ROOT $realpath_root;

        # 'internal' direktifi bu location bloğuna sadece Nginx'in içinden erişilmesini sağlar.
        # Dışarıdan direkt index.php'ye erişimi engeller.
        internal;
    }

    # ÖNEMLİ DÜZELTME: Bu blok kaldırıldı veya yukarıdaki gibi birleştirildi.
    # PHP dosyalarına doğrudan erişimi engelleyen, ancak index.php'nin işlenmesini sağlayan bir yapı olmalı.
    # Eğer doğrudan public/altında olmayan PHP dosyalarına erişimi engellemek istiyorsanız:
    location ~ \.php$ {
        return 404; # Bu satır, public/index.php dışındaki diğer php dosyalarına doğrudan erişimi engeller.
                    # Ancak dikkatli kullanılmalı, eğer Symfony'nin içindeki bazı vendor dosyaları public'ten erişmesi gerekiyorsa sorun olabilir.
                    # Genellikle yukarıdaki `location ~ ^/index\.php` bloğu yeterli ve doğru yaklaşımdır.
                    # Bu blok, sadece Symfony'nin public/index.php'si dışındaki PHP dosyalarına erişimi engellemek için isteğe bağlıdır.
                    # Symfony'nin `location /` içindeki `try_files` kuralı genellikle yeterli olur.
                    # Eğer PHP dosyalarına erişim sorun olmaya devam ederse bu bloğu tamamen silebilirsiniz.
    }
}